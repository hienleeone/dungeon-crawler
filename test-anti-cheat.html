<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anti-Cheat Test Suite</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        
        h1 {
            color: #667eea;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }
        
        .test-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 5px solid #667eea;
        }
        
        .test-section h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        .test-section p {
            color: #555;
            margin-bottom: 15px;
            line-height: 1.6;
        }
        
        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            overflow-x: auto;
        }
        
        .expected {
            background: #e7f3e7;
            border-left: 4px solid #28a745;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        
        .expected strong {
            color: #28a745;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            margin: 5px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .open-console {
            text-align: center;
            background: #fff3cd;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 2px dashed #ffc107;
        }
        
        .open-console strong {
            color: #856404;
            font-size: 1.1em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üõ°Ô∏è Anti-Cheat Test Suite</h1>
        <p class="subtitle">H·ªá th·ªëng ki·ªÉm tra b·∫£o m·∫≠t cho Dungeon Crawler</p>
        
        <div class="open-console">
            <strong>‚ö†Ô∏è Nh·∫•n F12 ƒë·ªÉ m·ªü Console tr∆∞·ªõc khi test!</strong>
        </div>
        
        <!-- Test 1 -->
        <div class="test-section">
            <h2>Test 1: Gold Overflow Protection</h2>
            <p>Th·ª≠ set v√†ng v∆∞·ª£t gi·ªõi h·∫°n (> 999 t·ª∑)</p>
            
            <button onclick="test1()">Ch·∫°y Test 1</button>
            
            <div class="code-block">
player.gold = 9999999999999999; // Set v√†ng si√™u cao<br>
console.log(player.gold); // Check k·∫øt qu·∫£
            </div>
            
            <div class="expected">
                <strong>‚úÖ K·ª≥ v·ªçng:</strong> Gi√° tr·ªã t·ª± ƒë·ªông gi·ªõi h·∫°n v·ªÅ 999,999,999,999<br>
                <strong>‚úÖ Console:</strong> C√≥ warning "Ph√°t hi·ªán tƒÉng v√†ng b·∫•t th∆∞·ªùng"
            </div>
            
            <div id="result1"></div>
        </div>
        
        <!-- Test 2 -->
        <div class="test-section">
            <h2>Test 2: Level Overflow Protection</h2>
            <p>Th·ª≠ set level v∆∞·ª£t gi·ªõi h·∫°n (> 10,000)</p>
            
            <button onclick="test2()">Ch·∫°y Test 2</button>
            
            <div class="code-block">
player.lvl = 50000; // Set level si√™u cao<br>
console.log(player.lvl); // Check k·∫øt qu·∫£
            </div>
            
            <div class="expected">
                <strong>‚úÖ K·ª≥ v·ªçng:</strong> Gi√° tr·ªã t·ª± ƒë·ªông gi·ªõi h·∫°n v·ªÅ 10,000<br>
                <strong>‚úÖ Console:</strong> C√≥ warning "Ph√°t hi·ªán tƒÉng level b·∫•t th∆∞·ªùng"
            </div>
            
            <div id="result2"></div>
        </div>
        
        <!-- Test 3 -->
        <div class="test-section">
            <h2>Test 3: Abnormal Increase Detection</h2>
            <p>TƒÉng v√†ng ƒë·ªôt ng·ªôt > 1 tri·ªáu</p>
            
            <button onclick="test3()">Ch·∫°y Test 3</button>
            
            <div class="code-block">
let currentGold = player.gold;<br>
player.gold = currentGold + 5000000; // TƒÉng 5 tri·ªáu<br>
console.log('V√†ng c≈©:', currentGold, 'V√†ng m·ªõi:', player.gold);
            </div>
            
            <div class="expected">
                <strong>‚úÖ K·ª≥ v·ªçng:</strong> Console log warning "Ph√°t hi·ªán tƒÉng v√†ng b·∫•t th∆∞·ªùng"<br>
                <strong>‚úÖ H√†nh vi:</strong> V√†ng v·∫´n tƒÉng nh∆∞ng c√≥ c·∫£nh b√°o trong log
            </div>
            
            <div id="result3"></div>
        </div>
        
        <!-- Test 4 -->
        <div class="test-section">
            <h2>Test 4: Rate Limiting (Debounce)</h2>
            <p>Spam save nhi·ªÅu l·∫ßn li√™n t·ª•c</p>
            
            <button onclick="test4()">Ch·∫°y Test 4 (Spam 20 l·∫ßn)</button>
            
            <div class="code-block">
for(let i=0; i&lt;20; i++) {<br>
&nbsp;&nbsp;saveData(); // G·ªçi save 20 l·∫ßn<br>
&nbsp;&nbsp;console.log('Save l·∫ßn', i+1);<br>
}
            </div>
            
            <div class="expected">
                <strong>‚úÖ K·ª≥ v·ªçng:</strong> Console s·∫°ch, kh√¥ng c√≥ warning spam<br>
                <strong>‚úÖ H√†nh vi:</strong> Ch·ªâ save 1 l·∫ßn sau 3 gi√¢y (debounce)<br>
                <strong>‚úÖ Firebase:</strong> Ki·ªÉm tra Network tab - ch·ªâ 1 request
            </div>
            
            <div id="result4"></div>
        </div>
        
        <!-- Test 5 -->
        <div class="test-section">
            <h2>Test 5: Data Validation on Save</h2>
            <p>Th·ª≠ save d·ªØ li·ªáu kh√¥ng h·ª£p l·ªá</p>
            
            <button onclick="test5()">Ch·∫°y Test 5</button>
            
            <div class="code-block">
player.gold = 999999999999999; // V∆∞·ª£t limit<br>
player.lvl = 20000; // V∆∞·ª£t limit<br>
savePlayerData(); // Th·ª≠ save
            </div>
            
            <div class="expected">
                <strong>‚úÖ K·ª≥ v·ªçng:</strong> Alert "D·ªØ li·ªáu kh√¥ng h·ª£p l·ªá!"<br>
                <strong>‚úÖ H√†nh vi:</strong> Kh√¥ng l∆∞u ƒë∆∞·ª£c l√™n Firebase<br>
                <strong>‚úÖ Console:</strong> Error "D·ªØ li·ªáu kh√¥ng h·ª£p l·ªá! ƒê√£ ph√°t hi·ªán gi√° tr·ªã b·∫•t th∆∞·ªùng."
            </div>
            
            <div id="result5"></div>
        </div>
        
        <!-- Test 6 -->
        <div class="test-section">
            <h2>Test 6: Checksum Integrity (Manual)</h2>
            <p>Test t√≠nh to√†n v·∫πn d·ªØ li·ªáu</p>
            
            <div class="expected">
                <strong>üìù H∆∞·ªõng d·∫´n th·ªß c√¥ng:</strong><br>
                1. L∆∞u game b√¨nh th∆∞·ªùng (auto-save ho·∫∑c logout)<br>
                2. V√†o Firebase Console > Database<br>
                3. T√¨m users/{uid}/playerData<br>
                4. S·ª≠a tr·ª±c ti·∫øp gi√° tr·ªã gold trong JSON<br>
                5. Reload trang game<br>
                <strong>‚úÖ K·ª≥ v·ªçng:</strong> Alert "C·∫£nh b√°o: Ph√°t hi·ªán d·ªØ li·ªáu b·∫•t th∆∞·ªùng!"
            </div>
        </div>
        
        <!-- Test 7 -->
        <div class="test-section">
            <h2>Test 7: Firebase Security Rules</h2>
            <p>Test quy·ªÅn truy c·∫≠p database</p>
            
            <div class="expected">
                <strong>üìù Ki·ªÉm tra tr√™n Firebase Console:</strong><br>
                1. V√†o Realtime Database > Rules tab<br>
                2. Nh·∫•n "Rules Playground"<br>
                3. Test: Read /users/{otherUID} v·ªõi auth c·ªßa b·∫°n<br>
                <strong>‚úÖ K·ª≥ v·ªçng:</strong> Permission Denied (kh√¥ng ƒë·ªçc ƒë∆∞·ª£c data ng∆∞·ªùi kh√°c)<br><br>
                
                4. Test: Write /leaderboard/{randomName} m√† kh√¥ng auth<br>
                <strong>‚úÖ K·ª≥ v·ªçng:</strong> Permission Denied (ph·∫£i ƒëƒÉng nh·∫≠p m·ªõi ghi ƒë∆∞·ª£c)
            </div>
        </div>
        
        <!-- Summary -->
        <div class="test-section" style="border-left-color: #28a745; background: #e7f3e7;">
            <h2>üìä T·ªïng K·∫øt</h2>
            <p><strong>N·∫øu t·∫•t c·∫£ test PASS:</strong></p>
            <ul style="margin-left: 20px; line-height: 1.8;">
                <li>‚úÖ Object Protection ho·∫°t ƒë·ªông (auto-clamp gi√° tr·ªã)</li>
                <li>‚úÖ Abnormal Detection ho·∫°t ƒë·ªông (log warning)</li>
                <li>‚úÖ Rate Limiting ho·∫°t ƒë·ªông (debounce)</li>
                <li>‚úÖ Data Validation ho·∫°t ƒë·ªông (reject invalid data)</li>
                <li>‚úÖ Checksum ho·∫°t ƒë·ªông (detect tampering)</li>
                <li>‚úÖ Firebase Rules ho·∫°t ƒë·ªông (access control)</li>
            </ul>
            <br>
            <p><strong style="color: #28a745;">üéØ H·ªá th·ªëng ch·∫∑n ƒë∆∞·ª£c 80-90% cheat th√¥ng th∆∞·ªùng!</strong></p>
        </div>
    </div>
    
    <script>
        // Open game in iframe (for testing context)
        if (!window.player) {
            alert('‚ö†Ô∏è Vui l√≤ng m·ªü trang n√†y c√πng v·ªõi game ƒëang ch·∫°y!\n\nC√°ch 1: M·ªü game ·ªü tab kh√°c, sau ƒë√≥ test trong Console c·ªßa tab game\nC√°ch 2: Click link ph√≠a d∆∞·ªõi ƒë·ªÉ m·ªü game');
            
            // Th√™m link m·ªü game
            const openGameBtn = document.createElement('div');
            openGameBtn.style.cssText = 'text-align: center; margin: 20px; padding: 20px; background: #fff3cd; border-radius: 10px;';
            openGameBtn.innerHTML = '<button onclick="window.open(\'http://127.0.0.1:5500/index.html\', \'_blank\')" style="font-size: 1.2em; padding: 15px 40px;">üéÆ M·ªü Game</button><br><br><small>Sau khi m·ªü game, copy c√°c l·ªánh test v√†o Console c·ªßa tab game</small>';
            document.querySelector('.container').insertBefore(openGameBtn, document.querySelector('.container').firstChild.nextSibling.nextSibling);
        }
        
        function showResult(id, success, message) {
            const resultDiv = document.getElementById(id);
            resultDiv.className = 'status ' + (success ? 'success' : 'error');
            resultDiv.textContent = message;
        }
        
        function test1() {
            const code = `
if (typeof player === 'undefined') {
    alert('‚ùå Game ch∆∞a load! Vui l√≤ng m·ªü game tr∆∞·ªõc.');
} else {
    const oldGold = player.gold;
    player.gold = 9999999999999999;
    const newGold = player.gold;
    
    if (newGold <= 999999999999) {
        console.log('‚úÖ Test 1 PASS: Gold clamped to', newGold.toLocaleString());
        alert('‚úÖ Test 1 PASS: Gold t·ª± ƒë·ªông gi·ªõi h·∫°n v·ªÅ ' + newGold.toLocaleString());
    } else {
        console.log('‚ùå Test 1 FAIL: Gold =', newGold);
        alert('‚ùå Test 1 FAIL: Gold kh√¥ng b·ªã gi·ªõi h·∫°n!');
    }
}`;
            
            const msg = "üìã Copy ƒëo·∫°n code sau v√†o Console c·ªßa tab game:\n\n" + code;
            prompt(msg, code);
        }
        
        function test2() {
            const code = `
if (typeof player === 'undefined') {
    alert('‚ùå Game ch∆∞a load! Vui l√≤ng m·ªü game tr∆∞·ªõc.');
} else {
    player.lvl = 50000;
    const newLvl = player.lvl;
    
    if (newLvl <= 10000) {
        console.log('‚úÖ Test 2 PASS: Level clamped to', newLvl);
        alert('‚úÖ Test 2 PASS: Level t·ª± ƒë·ªông gi·ªõi h·∫°n v·ªÅ ' + newLvl);
    } else {
        console.log('‚ùå Test 2 FAIL: Level =', newLvl);
        alert('‚ùå Test 2 FAIL: Level kh√¥ng b·ªã gi·ªõi h·∫°n!');
    }
}`;
            
            prompt("üìã Copy v√†o Console c·ªßa tab game:", code);
        }
        
        function test3() {
            const code = `
if (typeof player === 'undefined') {
    alert('‚ùå Game ch∆∞a load!');
} else {
    console.clear();
    const oldGold = player.gold;
    player.gold = oldGold + 5000000;
    console.log('V√†ng c≈©:', oldGold.toLocaleString(), '‚Üí V√†ng m·ªõi:', player.gold.toLocaleString());
    alert('‚úÖ Ki·ªÉm tra Console xem c√≥ warning kh√¥ng!');
}`;
            
            prompt("üìã Copy v√†o Console c·ªßa tab game:", code);
        }
        
        function test4() {
            const code = `
if (typeof saveData === 'undefined') {
    alert('‚ùå Game ch∆∞a load!');
} else {
    console.clear();
    console.log('üîÑ Spam 20 l·∫ßn save...');
    for(let i=0; i<20; i++) {
        saveData();
        console.log('Save l·∫ßn', i+1);
    }
    console.log('‚è≥ ƒê·ª£i 4 gi√¢y r·ªìi ki·ªÉm tra Network tab (F12 > Network)');
    setTimeout(() => {
        alert('‚úÖ Ki·ªÉm tra:\\n1. Console c√≥ s·∫°ch kh√¥ng?\\n2. Network tab c√≥ bao nhi√™u request save?\\n\\nK·ª≥ v·ªçng: Console s·∫°ch, ch·ªâ 1 request');
    }, 4000);
}`;
            
            prompt("üìã Copy v√†o Console c·ªßa tab game:", code);
        }
        
        function test5() {
            const code = `
if (typeof player === 'undefined' || typeof savePlayerData === 'undefined') {
    alert('‚ùå Game ch∆∞a load!');
} else {
    console.clear();
    player.gold = 999999999999999;
    player.lvl = 20000;
    console.log('Th·ª≠ save v·ªõi gold:', player.gold, 'level:', player.lvl);
    savePlayerData().then(() => {
        alert('Ki·ªÉm tra console v√† popup alert!');
    });
}`;
            
            prompt("üìã Copy v√†o Console c·ªßa tab game:", code);
        }
    </script>
</body>
</html>
